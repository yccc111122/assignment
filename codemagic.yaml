workflows:
  fullstack-app:
    name: Build and Deploy Fullstack App
    max_build_duration: 30
    environment:
      groups:
        - firebase-auth
      vars:
        NODE_VERSION: 16.13.0
        GOOGLE_APPLICATION_CREDENTIALS: $CM_BUILD_DIR/firebase_credentials.json
        FIREBASE_APP_ID: your-firebase-app-id # 替换为您的 Firebase App ID
    scripts:
      - name: Install Firebase CLI
        script: |
          curl -sL https://firebase.tools | bash
      - name: Decode and Save Firebase Credentials
        script: |
          echo "$FIREBASE_AUTH_CREDENTIALS" | base64 --decode > $GOOGLE_APPLICATION_CREDENTIALS
      - name: Install dependencies
        script: |
          npm install
      - name: Build the app
        script: |
          npm run build
      - name: Upload to Firebase App Distribution
        script: |
          firebase appdistribution:distribute ./build/app-release.apk \
          --app $FIREBASE_APP_ID \
          --groups beta-testers
    artifacts:
      - build/**/*
